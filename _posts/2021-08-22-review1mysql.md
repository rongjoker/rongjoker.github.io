---
layout: post
title: 温故知新之Mysql
---


### 第一讲 一条SQL如何执行

MySQL 可以分为 Server 层和存储引擎层两部分。Server 层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。而存储引擎层负责数据的存储和提取。<br>
1. 连接器(建立连接、获取权限、维护和管理连接)
2. 查询缓存(版本8取消了此功能)
3. 分析器(词法分析、语法分析、提示语法错误)
4. 优化器(通过分析器，明白你要干啥后，数据库就要针对你的需求想一个最优的解决方案，也就是执行计划，这个最优方案选择的操作，这个就是优化器要做的事情了。比如多个索引选择用哪个索引，多个表连接时选择什么连接顺序。优化器会改写sql，包括join的连接顺序，匹配索引，找到最优sql策略)
5. 执行器

   [![haeVkF.md.png](https://z3.ax1x.com/2021/08/31/haeVkF.md.png)](https://imgtu.com/i/haeVkF)

问题:如果表 T 中没有字段 k，而你执行了这个语句 select * from T where k=1, 那肯定是会报“不存在这个列”的错误： “Unknown column ‘k’ in ‘where clause’”。你觉得这个错误是在我们上面提到的哪个阶段报出来的呢？

答案: 《高性能mysql》里提到解析器和预处理器。 解析器处理语法和解析查询, 生成一课对应的解析树。 预处理器进一步检查解析树的合法。比如: 数据表和数据列是否存在, 别名是否有歧义等。如果通过则生成新的解析树，再提交给优化器。错误发生在在分析器处理阶段




## Mysql如何实现事务

这是一个很大的问题。可以从事务的ACID特性的四个角度来分析。



[![hpWHHA.md.png](https://z3.ax1x.com/2021/08/22/hpWHHA.md.png)](https://imgtu.com/i/hpWHHA)




### undo log && MVCC

